# app/exercises.py
from typing import Dict, List, Literal, TypedDict, Optional

Step = str
ExerciseType = Literal["stepper", "text", "breath"]

class Exercise(TypedDict):
    id: str
    type: ExerciseType
    title: str
    steps: List[Step]  # для type="text" можно 1 шаг; для breath — короткие инструкции

class Topic(TypedDict):
    id: str
    title: str
    intro: str
    exercises: List[Exercise]

# ===== Контент MVP =====

TOPICS: Dict[str, Topic] = {
    "panic": {
        "id": "panic",
        "title": "Паническая атака",
        "intro": "Помогу переждать волну и вернуть контроль шаг за шагом.",
        "exercises": [
            {
                "id": "panic_protocol",
                "type": "stepper",
                "title": "План при панической атаке (коротко)",
                "steps": [
                    "1) Оцени интенсивность сейчас по шкале 0–10.",
                    "2) Дыхание 4–2–6: вдох 4с — пауза 2с — выдох 6с (1 минута). Нажми ▶️ Далее, когда готов.",
                    "3) 5–4–3–2–1: назови 5, что видишь; 4 — можешь потрогать; 3 — слышишь; 2 — чувствуешь телом; 1 — запах/вкус.",
                    "4) Напоминание: это безопасно, пройдёт в течение минут. Это волна — ты не обязан бороться, просто пережди.",
                    "5) Мини-план на 10 минут: стакан воды / свежий воздух у окна / медленный шаг. Что выберешь?",
                ],
            },
            {
                "id": "pmr_short",
                "type": "stepper",
                "title": "Прогрессивная релаксация (3 минуты)",
                "steps": [
                    "1) Сожми кисти на 5 секунд и отпусти. Отметь разницу.",
                    "2) Плечи: подними к ушам на 5с и отпусти.",
                    "3) Лицо: сильно зажмурься на 5с и расслабь.",
                    "4) Живот: мягко вдохни, на выдохе отпусти напряжение.",
                    "5) Итог: оцени напряжение 0–10. Что изменилось?",
                ],
            },
        ],
    },
    "anxiety": {
        "id": "anxiety",
        "title": "Тревога",
        "intro": "Выберем способ снизить тревогу и вернуть ясность.",
        "exercises": [
            {
                "id": "grounding",
                "type": "stepper",
                "title": "Заземление 5-4-3-2-1",
                "steps": [
                    "Сделай медленный выдох. Теперь перечисли 5 вещей, которые видишь.",
                    "Назови 4 объекта, которых можешь коснуться.",
                    "Назови 3 звука вокруг.",
                    "Назови 2 ощущения в теле.",
                    "Назови 1 запах или вкус. Оцени тревогу 0–10.",
                ],
            },
            {
                "id": "catastrophizing",
                "type": "stepper",
                "title": "Анти-катастрофизация (КПТ-мини)",
                "steps": [
                    "Опиши мысль, которая тревожит, одним предложением.",
                    "Доказательства «за» и «против» этой мысли? По 2–3 пункта.",
                    "Наихудший, наилучший и наиболее реалистичный исход — по одному предложению.",
                    "Что я могу сделать в ближайшие 10–20 минут, чтобы поддержать себя?",
                ],
            },
        ],
    },
    "sadness": {
        "id": "sadness",
        "title": "Грусть/упадок",
        "intro": "Чуть больше заботы и маленькое действие.",
        "exercises": [
            {
                "id": "self_compassion",
                "type": "stepper",
                "title": "Самосострадание (3 шага)",
                "steps": [
                    "1) Замечаю: опиши, что сейчас непросто (1–2 предложения).",
                    "2) Общность: «С каждым так бывает» — какие слова поддержки ты бы сказал другу?",
                    "3) Доброта к себе: сформулируй тёплую фразу для себя на сегодня.",
                ],
            },
            {
                "id": "behavioral_activation",
                "type": "stepper",
                "title": "Маленький шаг активности",
                "steps": [
                    "Выбери действие на 10–15 минут (душ, лёгкая уборка, прогулка).",
                    "Поставь таймер и начни. Когда закончишь — вернись и оцени состояние 0–10.",
                ],
            },
        ],
    },
    "anger": {
        "id": "anger",
        "title": "Злость",
        "intro": "Сбросим импульс и проясним границы.",
        "exercises": [
            {
                "id": "stop_skill",
                "type": "stepper",
                "title": "Навык STOP",
                "steps": [
                    "S — Stop: остановись на мгновение и ничего не делай.",
                    "T — Take a breath: один глубокий вдох-выдох.",
                    "O — Observe: заметь мысли, чувства, тело.",
                    "P — Proceed: выбери действие в сторону ценностей (что важно сохранить?).",
                ],
            },
            {
                "id": "urge_surfing",
                "type": "stepper",
                "title": "Сёрфинг на импульсе",
                "steps": [
                    "Оцени силу импульса 0–10.",
                    "Наблюдай импульс как волну: где в теле сильнее всего?",
                    "Замечай, как волна то усиливается, то спадает — 1–2 минуты.",
                    "Оцени снова 0–10. Какой шаг сейчас будет бережным?",
                ],
            },
        ],
    },
    "sleep": {
        "id": "sleep",
        "title": "Сон",
        "intro": "Помогу плавно успокоить систему перед сном.",
        "exercises": [
            {
                "id": "wind_down",
                "type": "stepper",
                "title": "Спокойное завершение дня (10 минут)",
                "steps": [
                    "Список мыслей из головы: выпиши 3 пункта на завтра.",
                    "Тёплый свет/без экрана, 2 минуты дыхания 4–6.",
                    "Расслабление тела: скан от головы к стопам.",
                ],
            },
            {
                "id": "body_scan",
                "type": "text",
                "title": "Короткий скан тела",
                "steps": [
                    "Сядь/ляг удобно. Вдох 4 — пауза 2 — выдох 6. Пройди вниманием от макушки к стопам, мягко отпуская напряжение 1–2 минуты."
                ],
            },
        ],
    },
    "meditations": {
        "id": "meditations",
        "title": "Медитации",
        "intro": "Набор спокойных практик на 3–10 минут.",
        "exercises": [
            {
                "id": "breath_446",
                "type": "breath",
                "title": "Дыхание 4–4–6 (3 минуты)",
                "steps": [
                    "Вдох 4с — пауза 4с — выдох 6с. Дыши так 3 минуты. Если трудно — сократи до 2 минут.",
                ],
            },
            {
                "id": "open_monitoring",
                "type": "stepper",
                "title": "Открытое внимание (3 минуты)",
                "steps": [
                    "Сядь удобно. Заметь дыхание 3–4 цикла.",
                    "Перенеси внимание на звуки, ощущения, мысли — как на облака.",
                    "Если унесло — мягко вернись к дыханию. Заверши благодарностью себе.",
                ],
            },
        ],
    },
}
